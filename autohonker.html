<html>

<head>
  <script src="https://cdn.jsdelivr.net/npm/comfy.js@latest/dist/comfy.min.js"></script>
  <style>
    img {
      top: 0px;
      left: 0px;
      position: absolute;
      padding: 0px 0px 0px 0px;
      margin: 0px 0px 0px 0px;
      /* width: 1280px;
  height: 720px; */
    }
  </style>
</head>

<body>
  <audio id="audio" controls="" style="visibility: hidden;">
    <source id="source" type="audio/mp3">
  </audio>
  <img src="overlays/honk.png" id="honkoverlay" style="display:none" />
  <img src="overlays/nederland.png" id="nloverlay" style="display:none;" />
  <script type="text/javascript">
    var nlOverlay = document.getElementById('nloverlay');
    var honkOverlay = document.getElementById('honkoverlay');
    const elements = {
      source: document.querySelector("#source"),
      audio: document.querySelector("#audio")
    };
    // const TTS_BASE = "https://translate.google.com/translate_tts";
    // const TTS_BASE = "https://api.streamelements.com/kappa/v2/speech";
    const params = new URLSearchParams(location.search);
    // const ttsVoice = params.get("voice") || "Brian";
    let audioplay = [];
    let eventQueue = [];
    let msgQueue = [];
    var messageLength = "";
    let ttsTimer = false;
    let nederlands = new Audio('nederland.mp3')
    let honk = '../Stream memes/honk/honk-sound.mp3';
    let because = '../Stream memes/honk/because.wav';
    let honk2 = '../Stream memes/honk/honk2.wav';
    let gossipblue = '../Stream memes/honk/gossipBlue_honk_02.wav';
    let honkb3 = '../Stream memes/honk/ALl/goose_honk_b_03.wav';
    let pylon3 = '../Stream memes/honk/ALl/goose_honk_pylon_03.wav';
    let harmonica2 = '../Stream memes/honk/ALl/goose_honk_harmonica_02.wav';
    let harmonica6 = '../Stream memes/honk/ALl/goose_honk_harmonica_06.wav';
    let soap4 = '../Stream memes/honk/ALl/goose_honk_soap_04.wav';
    let trash3 = '../Stream memes/honk/ALl/goose_honk_trashlid_03.wav';
    let walkie4 = '../Stream memes/honk/ALl/goose_honk_walkie_talkie_04.wav';
    let walkie3 = '../Stream memes/honk/ALl/goose_honk_walkie_talkie_03.wav';
    let honkb6 = '../Stream memes/honk/ALl/goose_honk_b_06.wav';
    let shortsong = [honk, because, honk2, gossipblue, honkb3, pylon3, harmonica2, harmonica6, soap4, trash3, walkie4, walkie3, honkb6];

    var wildrse = '../Stream memes/honk/wild_goose_battle_rubysapph.mp3';
    var wildrby = '../Stream memes/honk/wild_goose_battle.mp3';
    var megalo1 = '../Stream memes/honk/undertale-megalovania-but-its-honked-by-the-goose.mp3';
    var still = '../Stream memes/honk/still_a_goose.mp3';
    var megalo2 = '../Stream memes/honk/MegaHONKvaniaSHORT.mp3';
    var betahonk = '../Stream memes/honk/Goose Honk (Beta Mix) -Untitled Goose Game.mp3';
    var venga = '../Stream memes/honk/vengagoose_we_like_to_party.mp3';
    var toxic = '../Stream memes/honk/toxic_goose.mp3';
    var toss = '../Stream memes/honk/Toss_a_Coin_to_Your_Goose.mp3';
    var mii = '../Stream memes/honk/mii_channel_goose.mp3';
    var nineties = '../Stream memes/honk/HONKING_IN_THE_90s_NOT_WHEN_I_SHIFT_INTO_MAXIMUM_OVERHONK.mp3';
    var battle = '../Stream memes/honk/battle_against_a_true_goose.mp3';
    var duckmoon = '../Stream memes/honk/ducktales_the_moon.mp3';
    var road = '../Stream memes/honk/On the road again.mp3';
    var ghostbusters = '../Stream memes/honk/Ghostbusters.mp3';
    var doom = '../Stream memes/honk/Doom.mp3';
    var miles = '../Stream memes/honk/500_miles.mp3';
    var africa1 = '../Stream memes/honk/Africa by Honkhonk1.mp3';
    var africa2 = '../Stream memes/honk/Africa by Honkhonk2.mp3';
    var caramell = '../Stream memes/honk/Caramelldansen featuring Goose.mp3';
    var cascada = '../Stream memes/honk/Cascada_-_Everytime_We_Honk.mp3';
    var country = '../Stream memes/honk/country_roads.mp3';
    var curb = '../Stream memes/honk/curb_your_engooseiasm.mp3';
    var goosetales = '../Stream memes/honk/goosetales.mp3';
    var smashmouth = '../Stream memes/honk/smash mouth - all star.mp3';
    var vivaldi = '../Stream memes/honk/Vivaldis_Four_Seasons_-_Spring_1_Allegro.mp3';
    var rickroll1 = '../Stream memes/honk/Rickroll.mp3';
    var rickroll2 = '../Stream memes/honk/Rickroll0.mp3';
    var numberone = '../Stream memes/honk/we_are_number_HONK.mp3';
    var blindhonks = '../Stream memes/honk/the_weeknd_-_blinding_honks.mp3';
    var pokemonwild2 = '../Stream memes/honk/Pokemon_ Wild Goose Battle.mp3';
    var goosalina = '../Stream memes/honk/dame_mas_gooselina.mp3';
    var takeonme = '../Stream memes/honk/dame_mas_gooselina.mp3';

    var longsong = [wildrse, wildrby, megalo1, still, megalo2, betahonk, venga, toxic, toss, mii, nineties, battle, duckmoon, road, ghostbusters, doom, miles, africa1, africa2, caramell,
     cascada, country, curb, goosetales, smashmouth, vivaldi, rickroll1, rickroll2, numberone, blindhonks, pokemonwild2, goosalina, takeonme
     //Delete bottom row
     ,rickroll1, rickroll2, numberone, blindhonks, pokemonwild2, goosalina, takeonme,rickroll1, rickroll2, numberone, blindhonks, pokemonwild2, goosalina, takeonme
     ];

    var everytimef = '../Stream memes/honk/og/Cascada_-_Everytime_We_Honk.wav';
    var curbf = '../Stream memes/honk/og/curb_your_engooseiasm.wav';
    var doomf = '../Stream memes/honk/og/Doom.mp3';
    var duckmoonf = '../Stream memes/honk/og/ducktales_the_moon.mp3';
    var enterf = '../Stream memes/honk/og/Enterprising_Young_Geese.mp3';
    var firef = '../Stream memes/honk/og/fireflies_by_goose_city.mp3';
    var ghostf = '../Stream memes/honk/og/Ghostbusters.mp3';
    var goosef = '../Stream memes/honk/og/goosetales.wav';
    var ninetiesf = '../Stream memes/honk/og/HONKING_IN_THE_90s_NOT_WHEN_I_SHIFT_INTO_MAXIMUM_OVERHONK.mp3';
    var megalo1f = '../Stream memes/honk/og/MegaHONKvania.mp3';
    var miif = '../Stream memes/honk/og/mii_channel_goose.mp3';
    var roadf = '../Stream memes/honk/og/On the road again.mp3';
    var rickf = '../Stream memes/honk/og/Rickroll.mp3';
    var smashf = '../Stream memes/honk/og/smash mouth - all star - a url-hoarder-official property.mp3';
    var stillf = '../Stream memes/honk/og/still_a_goose.mp3';
    var tossf = '../Stream memes/honk/og/Toss_a_Coin_to_Your_Goose.mp3';
    var toxicf = '../Stream memes/honk/og/toxic_goose.mp3';
    var megalo2f = '../Stream memes/honk/og/undertale-megalovania-but-its-honked-by-the-goose.mp3';
    var vengaf = '../Stream memes/honk/og/vengagoose_we_like_to_party.mp3';
    var wildbattlef = '../Stream memes/honk/og/wild_goose_battle.mp3';
    var wildbattlersef = '../Stream memes/honk/og/wild_goose_battle_rubysapph.mp3';
    var caramelf = '../Stream memes/honk/og/Caramelldansen featuring Goose.mp3';
    var battlef = '../Stream memes/honk/og/battle_against_a_true_goose.mp3';
    var milesf = '../Stream memes/honk/og/500_miles.mp3';
    var abbaf = '../Stream memes/honk/og/abba_dancing_queen.wav';
    var countryf = '../Stream memes/honk/og/country_roads.mp3';
    var vivaldif = '../Stream memes/honk/og/Vivaldis_Four_Seasons_-_Spring_1_Allegro.wav';
    var africaf = '../Stream memes/honk/og/Africa by Honkhonk.mp3';
    var takeonmef = '../Stream memes/honk/og/a_ha_take_on_me.mp3';
    var goosalinaf = '../Stream memes/honk/og/dame_mas_gooselina.mp3';
    var megalo3f = '../Stream memes/honk/og/Megooselovania.mp3';
    var pokwildgoosef = '../Stream memes/honk/og/Pokemon_ Wild Goose Battle.mp3';
    var blindhonksf = '../Stream memes/honk/og/the_weeknd_-_blinding_honks.mp3';
    var numberonef = '../Stream memes/honk/og/we_are_number_HONK.mp3';

    var fullsong = [everytimef, curbf, doomf, duckmoonf, enterf, firef, ghostf, goosef, ninetiesf, megalo1f, miif, roadf, rickf, smashf, stillf, tossf, toxicf, megalo2f, vengaf, wildbattlef, wildbattlersef, caramelf, battlef, africaf, milesf,
      countryf, vivaldif, abbaf, takeonmef, goosalinaf, megalo3f, pokwildgoosef, blindhonksf, numberonef
      //delete bottom row
      ,takeonmef, goosalinaf, megalo3f, pokwildgoosef, blindhonksf, numberonef
    ];

    ComfyJS.onCommand = (user, command, message, flags, extra) => {
      checkCommands(user, message, flags, self, extra);
    }

    ComfyJS.onChat = (user, message, flags, self, extra) => {
      checkCommands(user, message, flags, self, extra);
    }

    function checkCommands(user, message, flags, self, extra) {
      switch (extra.customRewardId) {
        case 'e7750cae-582f-43a6-931f-4faed7e1943d':
          break;
        case '231bc4b1-1e68-4779-9b05-04b49cc04822':
          console.log("Short song played");
          eventQueue.push(shortsong[Math.floor(Math.random() * shortsong.length)]);
          overlayTimer(honkOverlay, 0.1, "honktimer", false);
          break;
        case 'fb25b574-6227-40cf-a161-45a2d13cf657':
          console.log("Long song played");
          number = Math.floor(Math.random() * longsong.length);
          eventQueue.push(longsong[number]);
          overlayTimer(honkOverlay, 3, "honktimer", false);
          break;
        case 'ac09e298-9433-42dd-9c98-32a7be6a0d91':
          console.log("Full song played");
          number = Math.floor(Math.random() * longsong.length);
          eventQueue.push(fullsong[number]);
          overlayTimer(honkOverlay, 9, "honktimer", false);
          break;
        case '02db1e1d-a2c9-4208-9cd0-94cd6567c1d0':
          console.log("nederlands");
          nederlands.play();
          nlOverlay.style.display = "inline";
          overlayTimer(nlOverlay, randomIntInc(12,6), "nltimer", false);
          break;
      }

      audioController();

      if (!flags.customReward) {
        messageLength = [];
        messageLength = message.split(" ");
        if (message[0].substring(0, 1) !== "!") {
          if (messageLength.length > 20) {
            message = "";
            for (var i = 0; i < 20; i++) {
              message += messageLength[i] + " ";
            }
          }
          msgQueue.push(message.trim());
          playTTS();
        } else {}
      }
    }
    ComfyJS.Init("riekelt");

    //The code down here is for playing the honk queue.
    elements.audio.addEventListener('ended', audioController)

    async function audioController() {


      if (audio.paused) {
        if (eventQueue[0] === undefined) {} else {
          elements.source.src = eventQueue[0];
          const audio = elements.audio;

          await timeout(100)
          audio.load()
          audio.volume = 0.7;
          audio.play()

          eventQueue.shift()
        }
      }
    }

    function timeout(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    function randomIntInc(high, low) {
      var returnio = Math.floor(Math.random() * high);
      console.log(returnio);
      return returnio;
    }

    function overlayTimer(overlay, t, kindof, isTTS) {
      overlay.style.display = "inline";
      if (isTTS) {
        ttsTimer = true;
      }
      console.log(kindof + " is true");
      setTimeout(function() {
        console.log(kindof + " is false");
        overlay.style.display = "none";
        if (isTTS) {
          ttsTimer = false;
        }
      }, (t * 10 * 1000));
    }
  </script>
</body>

</html>
